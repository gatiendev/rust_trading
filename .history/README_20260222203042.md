
# Binance Trading Bot with Rust & ONNX

This project is a realâ€‘time cryptocurrency trading bot that streams data from Binance, performs feature engineering, runs an ONNX machine learning model, and executes trades based on the model's predictions. The core is written in Rust for maximum performance and low latency.

## âœ¨ New Features

- **Historical data preload** â€“ On startup, the bot automatically fetches the latest 50,000 M15 candlesticks (or loads from a Parquet cache) to provide context for feature engineering.
- **Modular codebase** â€“ Separated into logical modules (`binance_client`, `data_storage`, `kline`, `live_stream`) for maintainability and testability.
- **Efficient storage** â€“ Historical data is stored in **Parquet** (columnar format) for fast reloading. CSV export is also available.
- **Developmentâ€‘friendly** â€“ Uses `cargo watch` inside Docker for live code reloading, with proper environment variable handling and fileâ€‘watching exclusions.

## ğŸ—ï¸ System Architecture

```mermaid
flowchart TD
    A[Binance WebSocket\nMarket Data] --> B[Data Ingest\n& Normalization]
    A2[Binance REST API\nHistorical Klines] --> B2[Historical Data Fetcher]
    B2 --> C2[Parquet Cache]
    C2 --> D[Feature Engineering\n& Windowing]
    B --> D
    D --> E[ONNX Runtime\nML Inference]
    E --> F[Trading Decision\n& Risk Management]
    F --> G[Binance REST API\nOrder Execution]
    G --> H[Portfolio State\n& Order Management]
    H --> D
```

## ğŸ“ Project Structure

```
binance_trading_bot/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .env.example
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ Dockerfile.dev          # Development image with cargo-watch
â”œâ”€â”€ docker-compose.yml      # Development compose with live reload
â”œâ”€â”€ docker-compose.prod.yml # Production compose
â”œâ”€â”€ README.md
â””â”€â”€ src/
    â”œâ”€â”€ main.rs             # CLI entry point
    â”œâ”€â”€ binance_client.rs   # REST API client for historical klines
    â”œâ”€â”€ data_storage.rs     # Parquet/CSV I/O and DataFrame conversions
    â”œâ”€â”€ kline.rs            # Kline struct and deserialization
    â””â”€â”€ live_stream.rs      # WebSocket streaming logic
```

## ğŸš€ Getting Started

### Prerequisites

- Rust (edition 2021) â€“ for local builds.
- Docker & Docker Compose â€“ for containerized development/production.

### Installation (Local)

1. Clone the repository:

   ```bash
   git clone https://github.com/yourname/binance_trading_bot.git
   cd binance_trading_bot
   ```

2. Build the project:

   ```bash
   cargo build --release
   ```

### Usage

#### Live Streaming

```bash
# Live trade data (default)
cargo run

# 5â€‘minute candlesticks
cargo run m5

# 15â€‘minute candlesticks
cargo run m15
```

On startup, the bot loads (or fetches) the latest 50,000 M15 candles to warm up features.

#### Fetch Historical Data Manually

```bash
cargo run fetch-historical 15m 2025-01-01 2025-01-31 data/jan2025.parquet
```

This saves the data as Parquet and also creates a CSV file in the same directory.

### Docker Development (with live reload)

We provide a `docker-compose.dev.yml` for development that uses `cargo watch` to automatically rebuild and restart on code changes.

```bash
# Start the dev container (default stream: m5)
docker-compose -f docker-compose.dev.yml up

# Override stream type (e.g., trade)
STREAM_TYPE=trade docker-compose -f docker-compose.dev.yml up
```

- The container mounts your local source code, so changes are reflected immediately.
- Generated CSV/Parquet files are written to the containerâ€™s filesystem; to access them on the host, mount a volume (e.g., `./data:/app/data`).
- `cargo watch` is configured to ignore `data/` and `*.csv` to avoid infinite restart loops.

### Docker Production

```bash
# Build the production image
docker build -t binance-streamer .

# Run with default trade stream
docker run --rm binance-streamer

# Run with 5m candles
docker run --rm binance-streamer m5
```

## ğŸ§© Modules Explained

### `kline.rs`

Defines the `Kline` struct and custom deserializer for Binanceâ€™s arrayâ€‘based kline format.

### `binance_client.rs`

Contains two public functions:

- `fetch_klines_range` â€“ fetches klines between two timestamps with automatic pagination.
- `fetch_latest_klines` â€“ fetches the most recent N candles for a given interval.

### `data_storage.rs`

Handles conversion between `Vec<Kline>` and Polars `DataFrame`, and provides functions to save/load DataFrames as Parquet or CSV.

### `live_stream.rs`

Manages the WebSocket connection, parses incoming messages, and prints formatted data. It receives the historical `Vec<Kline>` as context (for future feature engineering).

### `main.rs`

Parses CLI arguments and orchestrates:

- `fetch-historical` subcommand.
- Default live mode: loads historical data (from cache or network) and starts the live stream.

## ğŸ§ª Development Roadmap

- [x] WebSocket streaming from Binance (trades, 5m, 15m) with readable timestamps
- [x] Docker containerization (production & development)
- [x] Historical data fetching and caching (Parquet)
- [x] Modular code structure
- [ ] Add more streams (order book, other intervals)
- [ ] Implement feature engineering (technical indicators)
- [ ] Integrate ONNX Runtime for inference
- [ ] Build decision engine with risk management
- [ ] Add order execution (testnet first)
- [ ] Live paper trading mode
- [ ] Realâ€‘money trading with safeguards

## âš™ï¸ Environment Variables

- `STREAM_TYPE` â€“ Sets the default stream for development (`trade`, `m5`, `m15`). Used in `docker-compose.dev.yml`.
- `RUST_BACKTRACE=1` â€“ Enables full backtraces on panics.

## ğŸ“š Dependencies

- `tokio` â€“ async runtime
- `tokio-tungstenite` â€“ WebSocket client
- `serde_json` â€“ JSON parsing
- `chrono` â€“ humanâ€‘readable timestamps
- `reqwest` â€“ REST API client
- `polars` â€“ DataFrame operations & Parquet/CSV I/O
- `anyhow` â€“ flexible error handling
- `futures-util` â€“ stream utilities
- `url` â€“ URL parsing
- (Future) `ort` â€“ ONNX Runtime bindings
- (Future) `ccxtâ€‘rust` â€“ exchange connectivity

## âš ï¸ Risk Disclaimer

Trading cryptocurrencies carries significant risk. This software is for educational purposes only. Use at your own risk. Always test thoroughly on testnet before using real funds.

---
